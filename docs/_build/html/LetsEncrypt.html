

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>LetsEncrypt with nDeploy &mdash; nDeploy 3.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="nDeploy 3.0 documentation" href="index.html"/>
        <link rel="next" title="http to https redirection" href="http_to_https_redirect.html"/>
        <link rel="prev" title="mod_remoteip" href="mod_remoteip.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> nDeploy
          

          
          </a>

          
            
            
              <div class="version">
                3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Installation &amp; Basic Configuration</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="mod_remoteip.html">mod_remoteip</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">LetsEncrypt with nDeploy</a></li>
<li class="toctree-l1"><a class="reference internal" href="http_to_https_redirect.html">http to https redirection</a></li>
</ul>
<p class="caption"><span class="caption-text">Backends Setup</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="HHVM.html">Setting up HHVM</a></li>
<li class="toctree-l1"><a class="reference internal" href="PHP.html">Setting up PHP</a></li>
<li class="toctree-l1"><a class="reference internal" href="PYTHON_WSGI.html">Setting up Python (WSGI app)</a></li>
<li class="toctree-l1"><a class="reference internal" href="RUBY_RACK.html">Setting up Ruby(Rack app)</a></li>
<li class="toctree-l1"><a class="reference internal" href="NodeJS.html">Setting up NodeJS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Meteor.html">Setting up Meteor</a></li>
<li class="toctree-l1"><a class="reference internal" href="ColdFusion_Java.html">Setting up ColdFusion or Java</a></li>
</ul>
<p class="caption"><span class="caption-text">Administration &amp; Monitoring</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="nDeploy_Administration.html">Administration of nDeploy plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="Monitoring.html">Monitoring nginx and app servers</a></li>
<li class="toctree-l1"><a class="reference internal" href="Logs.html">Managing Logs</a></li>
</ul>
<p class="caption"><span class="caption-text">nDeploy Cluster</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="cluster_architecture.html">nDeploy cluster architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="nDeploy_cluster_setup.html">nDeploy cluster setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="Upgrade_cluster.html">nDeploy cluster upgrade</a></li>
</ul>
<p class="caption"><span class="caption-text">Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">nDeploy</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>LetsEncrypt with nDeploy</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/LetsEncrypt.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="letsencrypt-with-ndeploy">
<h1>LetsEncrypt with nDeploy<a class="headerlink" href="#letsencrypt-with-ndeploy" title="Permalink to this headline">Â¶</a></h1>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last"><em>Note that this feature will be depricated in future versions of nDeploy.</em></p>
</div>
<ol class="arabic simple">
<li>You need to install the certbot official client from <a class="reference external" href="https://certbot.eff.org/">https://certbot.eff.org/</a></li>
</ol>
<p>2. create the file /opt/nDeploy/conf/letsencrypt.yaml which should contain</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">letsencrypt</span><span class="p">:</span> <span class="s2">&quot;path to letsencrypt or certbot binary in quotes&quot;</span>
<span class="n">email</span><span class="p">:</span> <span class="s2">&quot;admin email address in quotes&quot;</span>
</pre></div>
</div>
<p>For example</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@cpanel</span> <span class="p">[</span><span class="o">~</span><span class="p">]</span><span class="c1"># cat /opt/nDeploy/conf/letsencrypt.yaml</span>
<span class="n">letsencrypt</span><span class="p">:</span> <span class="s2">&quot;/usr/bin/certbot&quot;</span>
<span class="n">email</span><span class="p">:</span> <span class="s2">&quot;cert_renewels@sysally.net&quot;</span>
</pre></div>
</div>
<p>3. Once step 2 is complete. the nDeploy GUI will show up LetsEncrypt cert setup
Note that the GUI is running the following command</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">certbot</span> <span class="o">--</span><span class="n">email</span>  <span class="n">cert_renewels</span><span class="nd">@sysally</span><span class="o">.</span><span class="n">net</span> <span class="o">--</span><span class="n">text</span> <span class="o">--</span><span class="n">renew</span><span class="o">-</span><span class="n">by</span><span class="o">-</span><span class="n">default</span> <span class="o">--</span><span class="n">agree</span><span class="o">-</span><span class="n">tos</span> <span class="o">--</span><span class="n">server</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">acme</span><span class="o">-</span><span class="n">v01</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">letsencrypt</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">directory</span> <span class="n">certonly</span> <span class="o">-</span><span class="n">a</span> <span class="n">webroot</span> <span class="o">--</span><span class="n">webroot</span><span class="o">-</span><span class="n">path</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span> <span class="o">-</span><span class="n">d</span> <span class="n">cpanel_main_domain</span> <span class="o">-</span><span class="n">d</span> <span class="n">cpanel_alias1</span> <span class="o">-</span><span class="n">d</span> <span class="n">cpanel_alias2</span>
</pre></div>
</div>
<p>So the command will fail unless the main_domain along with all aliases resolve to the server</p>
<p>4. Check the auto-renew setting</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">certbot</span> <span class="n">renew</span>
</pre></div>
</div>
<p>Once you find it error free ;add the command to roots cron and run it once daily</p>
<p>5. If you are proxying to cPanel http server note that the SSL vhost is only present in nginX and not apache in nDeploys LetsEncrypt implementation.
So You will need to use PROXY &gt;&gt; apache &gt;&gt; Proxy to cPanel httpd rather than PROXY &gt;&gt; apache_SSL &gt;&gt; Proxy to cPanel httpd(SSL)</p>
<p>6. For generating the Cert</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Login</span> <span class="n">to</span> <span class="n">cPanel</span> <span class="ow">and</span> <span class="n">select</span> <span class="n">the</span> <span class="n">nginX</span> <span class="n">plugin</span>

<span class="n">Select</span> <span class="n">domain</span><span class="o">.</span><span class="n">com</span> <span class="o">&gt;&gt;</span> <span class="n">CONFIGURE</span> <span class="o">&gt;&gt;</span> <span class="n">AUTO</span> <span class="o">&gt;&gt;</span> <span class="n">SUBMIT</span>

<span class="n">BACKEND</span> <span class="p">:</span> <span class="n">PROXY</span>
<span class="n">Backend</span> <span class="n">Type</span> <span class="p">:</span> <span class="n">You</span> <span class="n">can</span> <span class="n">select</span> <span class="n">anything</span> <span class="n">here</span>
<span class="n">Select</span> <span class="n">a</span> <span class="n">configuration</span> <span class="n">template</span><span class="p">:</span> <span class="n">LetsEncrypt</span>

<span class="ow">and</span> <span class="n">SAVE</span>

<span class="n">This</span> <span class="n">will</span> <span class="n">make</span> <span class="n">your</span> <span class="n">site</span> <span class="n">config</span> <span class="n">suitable</span> <span class="k">for</span> <span class="n">ACME</span> <span class="n">challenge</span> <span class="n">response</span> <span class="p">(</span><span class="n">it</span> <span class="n">will</span> <span class="n">make</span> <span class="n">the</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">domain</span><span class="o">.</span><span class="n">com</span> <span class="n">inaccessible</span> <span class="k">for</span> <span class="n">security</span> <span class="n">reasons</span><span class="p">)</span>

<span class="n">Once</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">done</span> <span class="n">reload</span> <span class="n">the</span> <span class="n">config</span> <span class="n">generator</span> <span class="n">by</span> <span class="n">clicking</span> <span class="n">on</span> <span class="n">the</span> <span class="n">nginX</span> <span class="n">icon</span>

<span class="n">domain</span><span class="o">.</span><span class="n">com</span> <span class="o">&gt;&gt;</span> <span class="n">LETSENCRYPT</span> <span class="n">CERT</span> <span class="n">INSTALL</span> <span class="o">&gt;&gt;</span> <span class="n">ENABLE</span> <span class="o">&gt;&gt;</span> <span class="n">SUBMIT</span>

<span class="n">The</span> <span class="n">cert</span> <span class="n">will</span> <span class="n">now</span> <span class="n">get</span> <span class="n">setup</span> <span class="o">.</span> <span class="n">You</span> <span class="n">can</span> <span class="n">revert</span> <span class="n">the</span> <span class="n">config</span> <span class="n">template</span> <span class="k">for</span> <span class="n">non</span><span class="o">-</span><span class="n">SSL</span> <span class="n">domain</span> <span class="n">to</span> <span class="n">the</span> <span class="n">original</span> <span class="n">setting</span> <span class="n">now</span> <span class="o">.</span> <span class="n">You</span> <span class="n">will</span> <span class="n">also</span> <span class="n">find</span> <span class="n">that</span> <span class="n">that</span> <span class="n">there</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">domain</span><span class="o">.</span><span class="n">com_SSL</span> <span class="n">vhost</span> <span class="n">to</span> <span class="n">configure</span> <span class="n">now</span> <span class="o">.</span>
</pre></div>
</div>
<div data-disqus-identifier="LetsEncrypt with nDeploy" data-disqus-shortname="ndeploy-readthedocs-io" id="disqus_thread"></div></div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="http_to_https_redirect.html" class="btn btn-neutral float-right" title="http to https redirection" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="mod_remoteip.html" class="btn btn-neutral" title="mod_remoteip" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Anoop P Alias.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'3.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/disqus.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>