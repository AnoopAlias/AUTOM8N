<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>LetsEncrypt with nDeploy &mdash; nDeploy 3.0 documentation</title>
    
    <link rel="stylesheet" href="_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="nDeploy 3.0 documentation" href="index.html" />
    <link rel="next" title="http to https redirection" href="http_to_https_redirect.html" />
    <link rel="prev" title="mod_remoteip" href="mod_remoteip.html" /> 
  </head>
  <body role="document">
    <div class="header-wrapper" role="banner">
      <div class="header">
        <div class="headertitle"><a
          href="index.html">nDeploy 3.0 documentation</a></div>
        <div class="rel" role="navigation" aria-label="related navigation">
          <a href="mod_remoteip.html" title="mod_remoteip"
             accesskey="P">previous</a> |
          <a href="http_to_https_redirect.html" title="http to https redirection"
             accesskey="N">next</a> |
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="letsencrypt-with-ndeploy">
<h1>LetsEncrypt with nDeploy<a class="headerlink" href="#letsencrypt-with-ndeploy" title="Permalink to this headline">Â¶</a></h1>
<p>Note that this feature will be depricated in future versions</p>
<ol class="arabic simple">
<li>You need to install the certbot official client from <a class="reference external" href="https://certbot.eff.org/">https://certbot.eff.org/</a></li>
</ol>
<p>2. create the file /opt/nDeploy/conf/letsencrypt.yaml which should contain</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">letsencrypt</span><span class="p">:</span> <span class="s2">&quot;path to letsencrypt or certbot binary in quotes&quot;</span>
<span class="n">email</span><span class="p">:</span> <span class="s2">&quot;admin email address in quotes&quot;</span>
</pre></div>
</div>
<p>For example</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@cpanel</span> <span class="p">[</span><span class="o">~</span><span class="p">]</span><span class="c1"># cat /opt/nDeploy/conf/letsencrypt.yaml</span>
<span class="n">letsencrypt</span><span class="p">:</span> <span class="s2">&quot;/usr/bin/certbot&quot;</span>
<span class="n">email</span><span class="p">:</span> <span class="s2">&quot;cert_renewels@sysally.net&quot;</span>
</pre></div>
</div>
<p>3. Once step 2 is complete. the nDeploy GUI will show up LetsEncrypt cert setup
Note that the GUI is running the following command</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">certbot</span> <span class="o">--</span><span class="n">email</span>  <span class="n">cert_renewels</span><span class="nd">@sysally</span><span class="o">.</span><span class="n">net</span> <span class="o">--</span><span class="n">text</span> <span class="o">--</span><span class="n">renew</span><span class="o">-</span><span class="n">by</span><span class="o">-</span><span class="n">default</span> <span class="o">--</span><span class="n">agree</span><span class="o">-</span><span class="n">tos</span> <span class="o">--</span><span class="n">server</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">acme</span><span class="o">-</span><span class="n">v01</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">letsencrypt</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">directory</span> <span class="n">certonly</span> <span class="o">-</span><span class="n">a</span> <span class="n">webroot</span> <span class="o">--</span><span class="n">webroot</span><span class="o">-</span><span class="n">path</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span> <span class="o">-</span><span class="n">d</span> <span class="n">cpanel_main_domain</span> <span class="o">-</span><span class="n">d</span> <span class="n">cpanel_alias1</span> <span class="o">-</span><span class="n">d</span> <span class="n">cpanel_alias2</span>
</pre></div>
</div>
<p>So the command will fail unless the main_domain along with all aliases resolve to the server</p>
<p>4. Check the auto-renew setting</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">certbot</span> <span class="n">renew</span>
</pre></div>
</div>
<p>Once you find it error free ;add the command to roots cron and run it once daily</p>
<p>5. If you are proxying to cPanel http server note that the SSL vhost is only present in nginX and not apache in nDeploys LetsEncrypt implementation.
So You will need to use PROXY &gt;&gt; apache &gt;&gt; Proxy to cPanel httpd rather than PROXY &gt;&gt; apache_SSL &gt;&gt; Proxy to cPanel httpd(SSL)</p>
<p>6. For generating the Cert</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Login</span> <span class="n">to</span> <span class="n">cPanel</span> <span class="ow">and</span> <span class="n">select</span> <span class="n">the</span> <span class="n">nginX</span> <span class="n">plugin</span>

<span class="n">Select</span> <span class="n">domain</span><span class="o">.</span><span class="n">com</span> <span class="o">&gt;&gt;</span> <span class="n">CONFIGURE</span> <span class="o">&gt;&gt;</span> <span class="n">AUTO</span> <span class="o">&gt;&gt;</span> <span class="n">SUBMIT</span>

<span class="n">BACKEND</span> <span class="p">:</span> <span class="n">PROXY</span>
<span class="n">Backend</span> <span class="n">Type</span> <span class="p">:</span> <span class="n">You</span> <span class="n">can</span> <span class="n">select</span> <span class="n">anything</span> <span class="n">here</span>
<span class="n">Select</span> <span class="n">a</span> <span class="n">configuration</span> <span class="n">template</span><span class="p">:</span> <span class="n">LetsEncrypt</span>

<span class="ow">and</span> <span class="n">SAVE</span>

<span class="n">This</span> <span class="n">will</span> <span class="n">make</span> <span class="n">your</span> <span class="n">site</span> <span class="n">config</span> <span class="n">suitable</span> <span class="k">for</span> <span class="n">ACME</span> <span class="n">challenge</span> <span class="n">response</span> <span class="p">(</span><span class="n">it</span> <span class="n">will</span> <span class="n">make</span> <span class="n">the</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">domain</span><span class="o">.</span><span class="n">com</span> <span class="n">inaccessible</span> <span class="k">for</span> <span class="n">security</span> <span class="n">reasons</span><span class="p">)</span>

<span class="n">Once</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">done</span> <span class="n">reload</span> <span class="n">the</span> <span class="n">config</span> <span class="n">generator</span> <span class="n">by</span> <span class="n">clicking</span> <span class="n">on</span> <span class="n">the</span> <span class="n">nginX</span> <span class="n">icon</span>

<span class="n">domain</span><span class="o">.</span><span class="n">com</span> <span class="o">&gt;&gt;</span> <span class="n">LETSENCRYPT</span> <span class="n">CERT</span> <span class="n">INSTALL</span> <span class="o">&gt;&gt;</span> <span class="n">ENABLE</span> <span class="o">&gt;&gt;</span> <span class="n">SUBMIT</span>

<span class="n">The</span> <span class="n">cert</span> <span class="n">will</span> <span class="n">now</span> <span class="n">get</span> <span class="n">setup</span> <span class="o">.</span> <span class="n">You</span> <span class="n">can</span> <span class="n">revert</span> <span class="n">the</span> <span class="n">config</span> <span class="n">template</span> <span class="k">for</span> <span class="n">non</span><span class="o">-</span><span class="n">SSL</span> <span class="n">domain</span> <span class="n">to</span> <span class="n">the</span> <span class="n">original</span> <span class="n">setting</span> <span class="n">now</span> <span class="o">.</span> <span class="n">You</span> <span class="n">will</span> <span class="n">also</span> <span class="n">find</span> <span class="n">that</span> <span class="n">that</span> <span class="n">there</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">domain</span><span class="o">.</span><span class="n">com_SSL</span> <span class="n">vhost</span> <span class="n">to</span> <span class="n">configure</span> <span class="n">now</span> <span class="o">.</span>
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="mod_remoteip.html">mod_remoteip</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">LetsEncrypt with nDeploy</a></li>
<li class="toctree-l1"><a class="reference internal" href="http_to_https_redirect.html">http to https redirection</a></li>
</ul>
<p class="caption"><span class="caption-text">Backends Setup</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="HHVM.html">Setting up HHVM</a></li>
<li class="toctree-l1"><a class="reference internal" href="PHP.html">Setting up PHP</a></li>
<li class="toctree-l1"><a class="reference internal" href="PYTHON_WSGI.html">Setting up Python (WSGI app)</a></li>
<li class="toctree-l1"><a class="reference internal" href="RUBY_RACK.html">Setting up Ruby(Rack app)</a></li>
<li class="toctree-l1"><a class="reference internal" href="NodeJS.html">Setting up NodeJS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Meteor.html">Setting up Meteor</a></li>
<li class="toctree-l1"><a class="reference internal" href="ColdFusion_Java.html">Setting up ColdFusion or Java</a></li>
</ul>
<p class="caption"><span class="caption-text">Administration &amp; Monitoring</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="nDeploy_Administration.html">Administration of nDeploy plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="Monitoring.html">Monitoring nginx and app servers</a></li>
<li class="toctree-l1"><a class="reference internal" href="Logs.html">Managing Logs</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a></li>
</ul>

          <div role="search">
            <h3 style="margin-top: 1.5em;">Search</h3>
            <form class="search" action="search.html" method="get">
                <input type="text" name="q" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
            </form>
          </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <div role="navigation" aria-label="related navigaton">
            <a href="mod_remoteip.html" title="mod_remoteip"
              >previous</a> |
            <a href="http_to_https_redirect.html" title="http to https redirection"
              >next</a> |
            <a href="genindex.html" title="General Index"
              >index</a>
          </div>
          <div role="note" aria-label="source link">
              <br/>
              <a href="_sources/LetsEncrypt.txt"
                rel="nofollow">Show Source</a>
          </div>
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, Anoop P Alias.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.5.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>