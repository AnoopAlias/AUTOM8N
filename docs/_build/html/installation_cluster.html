

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>XtendWeb Cluster Installation &mdash; Documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Documentation" href="index.html"/>
        <link rel="next" title="mod_remoteip" href="mod_remoteip.html"/>
        <link rel="prev" title="XtendWeb standalone installation" href="installation_standalone.html"/>
    <link href="_static/style.css" rel="stylesheet" type="text/css">


  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> A U T O M 8 N
          

          
            
            <img src="_static/XtendWeb.png" class="logo" />
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">XtendWeb setup</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation_standalone.html">XtendWeb standalone installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation_standalone.html#application-servers">Application servers</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">XtendWeb Cluster Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#xtendweb-cluster-introduction">XtendWeb Cluster Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#xtendweb-cluster-requirements">XtendWeb Cluster Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-resource-calculations">Example resource calculations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#xtendweb-cluster-setup">XtendWeb cluster setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-slaves">The Slaves</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-master">The Master</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cpanel-horizontal-scaling-adding-more-web-servers">cPanel Horizontal scaling . Adding more web servers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mod_remoteip.html">mod_remoteip</a></li>
<li class="toctree-l1"><a class="reference internal" href="brotli_compression.html">brotli_compression</a></li>
<li class="toctree-l1"><a class="reference internal" href="http2.html">http2</a></li>
<li class="toctree-l1"><a class="reference internal" href="ModSecurity.html">ModSecurity</a></li>
<li class="toctree-l1"><a class="reference internal" href="ModSecurity.html#commercial-mod-security-rules-specifically-crafted-for-web-hosting-servers">Commercial Mod Security rules specifically crafted for web hosting servers</a></li>
<li class="toctree-l1"><a class="reference internal" href="Naxsi.html">Naxsi</a></li>
<li class="toctree-l1"><a class="reference internal" href="bruteforce_mitigation.html">Brute Force Mitigation</a></li>
<li class="toctree-l1"><a class="reference internal" href="bot_traffic_mitigation.html">Bad Bot Mitigation</a></li>
<li class="toctree-l1"><a class="reference internal" href="full_page_cache.html">Full Page cache</a><ul>
<li class="toctree-l2"><a class="reference internal" href="full_page_cache.html#full-page-cache-to-redis">Full page cache to redis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cpanel_server_analytics_using_netdata.html">cPanel server analytics using netdata</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cpanel_server_analytics_using_netdata.html#monitor-exim-using-netdata">Monitor exim using netdata</a></li>
<li class="toctree-l2"><a class="reference internal" href="cpanel_server_analytics_using_netdata.html#monitor-dovecot-using-netdata">Monitor Dovecot using netdata</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">User Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="UserDocs.html">XtendWeb User docs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="UserDocs.html#setup-url-redirects">Setup URL Redirects</a></li>
<li class="toctree-l2"><a class="reference internal" href="UserDocs.html#enable-directory-listing">Enable Directory listing</a></li>
<li class="toctree-l2"><a class="reference internal" href="UserDocs.html#content-optimization">Content Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="UserDocs.html#security-headers">Security Headers</a></li>
<li class="toctree-l2"><a class="reference internal" href="UserDocs.html#custom-nginx-configuration">Custom nginx configuration</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">SimpleR setup</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="simpler_resource_control.html">Simple Resource controller</a><ul>
<li class="toctree-l2"><a class="reference internal" href="simpler_resource_control.html#how-does-simpler-work">How does simpleR work</a></li>
<li class="toctree-l2"><a class="reference internal" href="simpler_resource_control.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="simpler_resource_control.html#default-resource-for-user">Default resource for user</a></li>
<li class="toctree-l2"><a class="reference internal" href="simpler_resource_control.html#tools-to-view-resource-usage">Tools to view resource usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="simpler_resource_control.html#to-view-systemd-config-loaded">To view systemd config loaded</a></li>
<li class="toctree-l2"><a class="reference internal" href="simpler_resource_control.html#to-view-the-cgroup-tree">To view the cgroup tree</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Support and Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Support.html">Support</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Support.html#if-you-have-already-purchased-a-support-plan">If you have already purchased a support plan</a></li>
<li class="toctree-l2"><a class="reference internal" href="Support.html#bug-report">Bug Report</a></li>
<li class="toctree-l2"><a class="reference internal" href="Support.html#announcements">Announcements</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Project_sponsors.html">Project Sponsors</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Project_sponsors.html#credits">CREDITS</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Partner_webhosts.html">Partner Webhosts</a></li>
</ul>
<p class="caption"><span class="caption-text">Application servers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="HHVM.html">Setting up HHVM</a><ul>
<li class="toctree-l2"><a class="reference internal" href="HHVM.html#on-centos7-cloudlinux7">On CentOS7 / CloudLinux7</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="PHP.html">Setting up PHP</a><ul>
<li class="toctree-l2"><a class="reference internal" href="PHP.html#on-centos6-centos7">On CentOS6/CentOS7</a></li>
<li class="toctree-l2"><a class="reference internal" href="PHP.html#on-cloudlinux6-cloudlinux7">On CloudLinux6/CloudLinux7</a></li>
<li class="toctree-l2"><a class="reference internal" href="PHP.html#php-fpm-user-level-master">PHP-FPM user level master</a></li>
<li class="toctree-l2"><a class="reference internal" href="PHP.html#where-are-my-php-logs">Where are my php logs?</a></li>
<li class="toctree-l2"><a class="reference internal" href="PHP.html#zendopcache-and-security-considerations-on-php-fpm-single-master-setup">ZendOpcache and security considerations on php-fpm single master setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="PHP.html#per-user-php-ini-custom-settings">Per user php.ini custom settings</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="PYTHON_WSGI.html">Setting up Python (WSGI app)</a></li>
<li class="toctree-l1"><a class="reference internal" href="RUBY_RACK.html">Setting up Ruby(Rack app)</a></li>
<li class="toctree-l1"><a class="reference internal" href="NodeJS.html">Setting up NodeJS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Meteor.html">Setting up Meteor</a></li>
<li class="toctree-l1"><a class="reference internal" href="ColdFusion_Java.html">Setting up ColdFusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tomcat_Java.html">Tomcat Java backend</a></li>
</ul>
<p class="caption"><span class="caption-text">Administration &amp; Monitoring</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="XtendWeb_Administration.html">Administration of XtendWeb plugin</a><ul>
<li class="toctree-l2"><a class="reference internal" href="XtendWeb_Administration.html#quick-reference-of-scripts-for-sysadmins">Quick Reference of scripts for sysadmins</a></li>
<li class="toctree-l2"><a class="reference internal" href="XtendWeb_Administration.html#config-generation-logic-and-customizations">Config Generation logic and customizations</a></li>
<li class="toctree-l2"><a class="reference internal" href="XtendWeb_Administration.html#layer7-application-layer-ddos-mitigation">Layer7(Application layer) DDOS mitigation</a></li>
<li class="toctree-l2"><a class="reference internal" href="XtendWeb_Administration.html#upgrading-xtendweb-and-nginx">Upgrading XtendWeb and Nginx</a></li>
<li class="toctree-l2"><a class="reference internal" href="XtendWeb_Administration.html#xtendweb-cluster-upgrade">XtendWeb cluster upgrade</a></li>
<li class="toctree-l2"><a class="reference internal" href="XtendWeb_Administration.html#migrating-xtendweb-settings">Migrating Xtendweb settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="XtendWeb_Administration.html#temporarily-disable-the-plugin">Temporarily disable the plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="XtendWeb_Administration.html#uninstall-the-plugin">Uninstall the plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="XtendWeb_Administration.html#remove-php-fpm-selector-plugin-on-cpanel-v66-and-above-feature-overlap">Remove PHP-FPM selector plugin on cPanel v66 and above(feature overlap)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Application_template.html">Application templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="Monitoring.html">Monitoring nginx and app servers</a></li>
<li class="toctree-l1"><a class="reference internal" href="Monitoring.html#monitoring-xtendweb-cpanel-cluster">Monitoring Xtendweb cPanel cluster</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Monitoring.html#database-replication">Database Replication</a></li>
<li class="toctree-l2"><a class="reference internal" href="Monitoring.html#unison-file-sync-status">Unison File Sync status</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Security_tools.html">Securing your cPanel server</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Security_tools.html#prevention-is-always-better-than-cure">Prevention is always better than cure</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Security_tools.html#commercial-malware-scanners">Commercial malware scanners</a></li>
<li class="toctree-l1"><a class="reference internal" href="Logs.html">Managing Logs</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">A U T O M 8 N</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>XtendWeb Cluster Installation</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="xtendweb-cluster-installation">
<h1>XtendWeb Cluster Installation<a class="headerlink" href="#xtendweb-cluster-installation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="xtendweb-cluster-introduction">
<h2>XtendWeb Cluster Introduction<a class="headerlink" href="#xtendweb-cluster-introduction" title="Permalink to this headline">¶</a></h2>
<p>XtendWeb cluster is the world&#8217;s easiest web application clustering solution featuring a fully automated deployment of a clustered DNS load balanced LAMP stack.
It is specifically designed for multi-datacenter deployment and use encrypted communication between the server</p>
<p>XtendWeb cluster provides high availability, scalability and an inherent data backup (application files and database are replicated and normally reside on 2 servers at any time )
Coupled with the simplicity and intuitiveness of cPanel control panel , XtendWeb cluster is a must have for any modern enterprise web application deployment</p>
<p>Cluster Components:</p>
<ol class="arabic simple">
<li>cPanel DNS providing multiple A records for round-robin DNS load balancing</li>
<li>Nginx servers running on all servers with server specific settings and serving files independently</li>
<li>Application servers (php-fpm, HHVM, Phusion Passenger)running on all servers and serving app independently</li>
<li>Csync2 - Syncing config across all servers</li>
<li>Unison - Syncing files across all servers</li>
<li>MaxScale router and MariaDB master-master replication - Database replication and query routing</li>
<li>Redis &amp; stunnel - Secure sharing of PHP session</li>
<li>XtendWeb - generating and Syncing configuration for all servers</li>
</ol>
</div>
<div class="section" id="xtendweb-cluster-requirements">
<h2>XtendWeb Cluster Requirements<a class="headerlink" href="#xtendweb-cluster-requirements" title="Permalink to this headline">¶</a></h2>
<p>Master Server :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">CentOS7</span><span class="o">+</span><span class="n">cPanel</span>
<span class="n">On</span> <span class="n">your</span> <span class="n">normal</span> <span class="n">RAM</span> <span class="n">requirement</span> <span class="n">add</span> <span class="mi">1</span> <span class="n">GB</span> <span class="n">Ram</span> <span class="n">extra</span> <span class="n">per</span> <span class="n">slave</span> <span class="k">for</span> <span class="n">Unison</span> <span class="n">file</span> <span class="n">sync</span> <span class="n">running</span> <span class="k">for</span> <span class="n">every</span> <span class="mi">100</span><span class="n">GB</span> <span class="n">Disk</span>
<span class="n">Also</span> <span class="n">add</span> <span class="n">enough</span> <span class="k">for</span> <span class="n">httpd</span> <span class="n">service</span> <span class="ow">and</span> <span class="n">mysql</span> <span class="n">service</span> <span class="n">which</span> <span class="n">will</span> <span class="n">be</span> <span class="n">running</span> <span class="kn">from</span> <span class="nn">master</span>
<span class="n">That</span> <span class="ow">is</span> <span class="n">on</span> <span class="n">a</span> <span class="n">cluster</span> <span class="k">with</span> <span class="mi">200</span><span class="n">GB</span> <span class="n">disk</span> <span class="k">for</span> <span class="n">example</span>
<span class="mi">1</span> <span class="n">slave</span> <span class="k">with</span> <span class="mi">200</span><span class="n">GB</span> <span class="n">disk</span>  <span class="p">:</span>  <span class="mi">1</span> <span class="n">GB</span> <span class="k">for</span> <span class="mi">100</span><span class="n">GB</span> <span class="n">per</span> <span class="n">slave</span> <span class="o">=</span> <span class="mi">2</span> <span class="n">GB</span>
<span class="mi">2</span> <span class="n">slave</span> <span class="k">with</span> <span class="mi">200</span><span class="n">GB</span> <span class="n">disk</span>  <span class="p">:</span>  <span class="mi">2</span><span class="p">(</span> <span class="mi">1</span> <span class="n">GB</span> <span class="k">for</span> <span class="mi">100</span><span class="n">GB</span> <span class="n">per</span> <span class="n">slave</span> <span class="p">)</span> <span class="o">=</span> <span class="mi">4</span> <span class="n">GB</span>
<span class="mi">3</span> <span class="n">slaves</span> <span class="k">with</span> <span class="mi">200</span><span class="n">GB</span> <span class="n">disk</span> <span class="p">:</span>  <span class="mi">3</span><span class="p">(</span> <span class="mi">1</span> <span class="n">GB</span> <span class="k">for</span> <span class="mi">100</span><span class="n">GB</span> <span class="n">per</span> <span class="n">slave</span> <span class="p">)</span> <span class="o">=</span> <span class="mi">6</span> <span class="n">GB</span>
</pre></div>
</div>
<p>Slave server:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Add</span> <span class="mi">1</span> <span class="n">GB</span> <span class="n">RAM</span> <span class="k">for</span> <span class="n">every</span> <span class="mi">100</span><span class="n">GB</span> <span class="n">disk</span> <span class="k">for</span> <span class="n">unison</span> <span class="n">filesync</span>
<span class="n">That</span> <span class="ow">is</span> <span class="k">for</span> <span class="n">a</span> <span class="n">slave</span> <span class="k">with</span> <span class="mi">200</span><span class="n">GB</span> <span class="n">disk</span> <span class="n">add</span> <span class="mi">2</span> <span class="n">GB</span> <span class="n">ram</span> <span class="n">extra</span> <span class="n">to</span> <span class="n">your</span> <span class="n">ram</span> <span class="n">requirement</span> <span class="n">calculation</span>
</pre></div>
</div>
</div>
<div class="section" id="example-resource-calculations">
<h2>Example resource calculations<a class="headerlink" href="#example-resource-calculations" title="Permalink to this headline">¶</a></h2>
<p>A typical single slave cluster setup with 200 GB disk and 8GB usable RAM would be</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Master</span> <span class="p">:</span> <span class="mi">200</span><span class="n">GB</span> <span class="n">Disk</span> <span class="ow">and</span> <span class="mi">8</span> <span class="o">+</span> <span class="mi">2</span> <span class="n">GB</span><span class="p">(</span><span class="n">unison</span><span class="p">)</span><span class="o">+</span> <span class="mi">2</span> <span class="n">GB</span> <span class="p">(</span><span class="n">extra</span> <span class="k">for</span> <span class="n">httpd</span> <span class="ow">and</span> <span class="n">mysql</span><span class="p">)</span> <span class="o">=</span> <span class="mi">12</span> <span class="n">GB</span> <span class="n">Ram</span>
<span class="n">Slave</span> <span class="p">:</span>  <span class="mi">200</span><span class="n">GB</span> <span class="n">Disk</span> <span class="ow">and</span> <span class="mi">8</span> <span class="o">+</span> <span class="mi">2</span> <span class="n">GB</span> <span class="p">(</span><span class="n">unison</span><span class="p">)</span> <span class="o">=</span> <span class="mi">10</span> <span class="n">GB</span> <span class="n">ram</span>
</pre></div>
</div>
<dl class="docutils">
<dt>A typical 2 slave cluster setup with 200 GB disk and 8GB usable RAM would be</dt>
<dd><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">Master</span> <span class="p">:</span> <span class="mi">200</span><span class="n">GB</span> <span class="n">Disk</span> <span class="ow">and</span> <span class="mi">8</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mi">4</span><span class="n">GB</span><span class="p">(</span><span class="n">unison</span><span class="p">)</span><span class="o">+</span> <span class="mi">2</span> <span class="n">GB</span> <span class="p">(</span><span class="n">extra</span> <span class="k">for</span> <span class="n">httpd</span> <span class="ow">and</span> <span class="n">mysql</span><span class="p">)</span> <span class="o">=</span> <span class="mi">14</span> <span class="n">GB</span> <span class="n">Ram</span>
<span class="n">Slave1</span> <span class="p">:</span>  <span class="mi">200</span><span class="n">GB</span> <span class="n">Disk</span> <span class="ow">and</span> <span class="mi">8</span> <span class="o">+</span> <span class="mi">2</span> <span class="n">GB</span> <span class="p">(</span><span class="n">unison</span><span class="p">)</span> <span class="o">=</span> <span class="mi">10</span> <span class="n">GB</span> <span class="n">ram</span>
<span class="n">Slave2</span> <span class="p">:</span>  <span class="mi">200</span><span class="n">GB</span> <span class="n">Disk</span> <span class="ow">and</span> <span class="mi">8</span> <span class="o">+</span> <span class="mi">2</span> <span class="n">GB</span> <span class="p">(</span><span class="n">unison</span><span class="p">)</span> <span class="o">=</span> <span class="mi">10</span> <span class="n">GB</span> <span class="n">ram</span>
</pre></div>
</div>
</dd>
<dt>A typical 3 slave cluster setup with 200 GB disk and 8GB usable RAM would be</dt>
<dd><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">Master</span> <span class="p">:</span> <span class="mi">200</span><span class="n">GB</span> <span class="n">Disk</span> <span class="ow">and</span> <span class="mi">8</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mi">6</span><span class="n">GB</span><span class="p">(</span><span class="n">unison</span><span class="p">)</span><span class="o">+</span> <span class="mi">2</span> <span class="n">GB</span> <span class="p">(</span><span class="n">extra</span> <span class="k">for</span> <span class="n">httpd</span> <span class="ow">and</span> <span class="n">mysql</span><span class="p">)</span> <span class="o">=</span> <span class="mi">16</span> <span class="n">GB</span> <span class="n">Ram</span>
<span class="n">Slave1</span> <span class="p">:</span>  <span class="mi">200</span><span class="n">GB</span> <span class="n">Disk</span> <span class="ow">and</span> <span class="mi">8</span> <span class="o">+</span> <span class="mi">2</span> <span class="n">GB</span> <span class="p">(</span><span class="n">unison</span><span class="p">)</span> <span class="o">=</span> <span class="mi">10</span> <span class="n">GB</span> <span class="n">ram</span>
<span class="n">Slave2</span> <span class="p">:</span>  <span class="mi">200</span><span class="n">GB</span> <span class="n">Disk</span> <span class="ow">and</span> <span class="mi">8</span> <span class="o">+</span> <span class="mi">2</span> <span class="n">GB</span> <span class="p">(</span><span class="n">unison</span><span class="p">)</span> <span class="o">=</span> <span class="mi">10</span> <span class="n">GB</span> <span class="n">ram</span>
<span class="n">Slave3</span> <span class="p">:</span>  <span class="mi">200</span><span class="n">GB</span> <span class="n">Disk</span> <span class="ow">and</span> <span class="mi">8</span> <span class="o">+</span> <span class="mi">2</span> <span class="n">GB</span> <span class="p">(</span><span class="n">unison</span><span class="p">)</span> <span class="o">=</span> <span class="mi">10</span> <span class="n">GB</span> <span class="n">ram</span>
</pre></div>
</div>
</dd>
</dl>
<p>Notice how the slave RAM requirement remain same,while master need 2 GB(for the 200GB disk sync) ram extra for each slave being added</p>
</div>
<div class="section" id="xtendweb-cluster-setup">
<h2>XtendWeb cluster setup<a class="headerlink" href="#xtendweb-cluster-setup" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Install CSF firewall on both servers and whitelist each others IP for access . The server&#8217;s hostname must be valid and should resolve correctly as many cluster components reply on hostname to connect</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As of XtendWeb 4.3.20, you will need a license for all servers(master and slaves) on the cluster.Else Installation will fail
Please visit <a class="reference external" href="https://autom8n.com/plans.html#plans">https://autom8n.com/plans.html#plans</a> for more info</p>
</div>
</div>
<div class="section" id="the-slaves">
<h2>The Slaves<a class="headerlink" href="#the-slaves" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Prepare any number of servers and install cPanel DNS only on it. The slave server is auto setup by the master</span>
<span class="c1"># So do nothing on it except install cPanel DNS only</span>
<span class="n">cd</span> <span class="o">/</span><span class="n">home</span> <span class="o">&amp;&amp;</span> <span class="n">curl</span> <span class="o">-</span><span class="n">o</span> <span class="n">latest</span><span class="o">-</span><span class="n">dnsonly</span> <span class="o">-</span><span class="n">L</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">securedownloads</span><span class="o">.</span><span class="n">cpanel</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="n">latest</span><span class="o">-</span><span class="n">dnsonly</span> <span class="o">&amp;&amp;</span> <span class="n">sh</span> <span class="n">latest</span><span class="o">-</span><span class="n">dnsonly</span>
<span class="n">ssh</span><span class="o">-</span><span class="n">keygen</span>
<span class="n">ssh</span><span class="o">-</span><span class="n">copy</span><span class="o">-</span><span class="nb">id</span> <span class="n">root</span><span class="nd">@masters</span><span class="o">-</span><span class="n">fqdn</span>
<span class="c1"># Login to WHM</span>
<span class="c1"># Home »Service Configuration »Service Manager</span>
<span class="c1"># Disable tailwatchd and all its drivers</span>

<span class="c1"># Home »Server Configuration »Update Preferences</span>
<span class="c1"># Set cPanel &amp; WHM Updates to Never Update</span>
</pre></div>
</div>
</div>
<div class="section" id="the-master">
<h2>The Master<a class="headerlink" href="#the-master" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#Install cPanel</span>
<span class="n">cd</span> <span class="o">/</span><span class="n">home</span> <span class="o">&amp;&amp;</span> <span class="n">curl</span> <span class="o">-</span><span class="n">o</span> <span class="n">latest</span> <span class="o">-</span><span class="n">L</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">securedownloads</span><span class="o">.</span><span class="n">cpanel</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="n">latest</span> <span class="o">&amp;&amp;</span> <span class="n">sh</span> <span class="n">latest</span>
<span class="n">ssh</span><span class="o">-</span><span class="n">keygen</span>
<span class="n">ssh</span><span class="o">-</span><span class="n">copy</span><span class="o">-</span><span class="nb">id</span> <span class="n">root</span><span class="nd">@slaves</span><span class="o">-</span><span class="n">fqdn</span>


<span class="c1"># Login to WHM</span>
<span class="c1"># Home »Software »MySQL/MariaDB Upgrade</span>
<span class="c1"># Upgrade to MariaDB 10.1 (General availability)</span>

<span class="n">yum</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">epel</span><span class="o">-</span><span class="n">release</span>
<span class="n">yum</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">AnoopAlias</span><span class="o">/</span><span class="n">XtendWeb</span><span class="o">/</span><span class="n">raw</span><span class="o">/</span><span class="n">ndeploy4</span><span class="o">/</span><span class="n">nDeploy</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">centos</span><span class="o">-</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">6.</span><span class="n">noarch</span><span class="o">.</span><span class="n">rpm</span>

<span class="n">yum</span> <span class="o">-</span><span class="n">y</span> <span class="o">--</span><span class="n">enablerepo</span><span class="o">=</span><span class="n">ndeploy</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">nginx</span><span class="o">-</span><span class="n">nDeploy</span> <span class="n">nDeploy</span> <span class="c1"># For nginx as webserver</span>
   <span class="n">OR</span>
<span class="n">yum</span> <span class="o">-</span><span class="n">y</span> <span class="o">--</span><span class="n">enablerepo</span><span class="o">=</span><span class="n">ndeploy</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">openresty</span><span class="o">-</span><span class="n">nDeploy</span> <span class="n">nDeploy</span> <span class="c1"># For openresty as webserver</span>

<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">nDeploy</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">cpanel</span><span class="o">-</span><span class="n">nDeploy</span><span class="o">-</span><span class="n">setup</span><span class="o">.</span><span class="n">sh</span> <span class="n">enable</span>

<span class="n">yum</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">python</span><span class="o">-</span><span class="n">pip</span> <span class="n">libffi</span><span class="o">-</span><span class="n">devel</span> <span class="n">python</span><span class="o">-</span><span class="n">paramiko</span> <span class="n">python</span><span class="o">-</span><span class="n">jinja2</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">ansible</span>



<span class="n">cd</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">nDeploy</span><span class="o">/</span><span class="n">conf</span><span class="o">/</span><span class="n">nDeploy</span><span class="o">-</span><span class="n">cluster</span>
<span class="n">cp</span> <span class="o">-</span><span class="n">p</span> <span class="n">hosts</span><span class="o">.</span><span class="n">sample</span> <span class="n">hosts</span>

<span class="c1"># Edit the hosts file</span>

<span class="n">cat</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">nDeploy</span><span class="o">/</span><span class="n">conf</span><span class="o">/</span><span class="n">nDeploy</span><span class="o">-</span><span class="n">cluster</span><span class="o">/</span><span class="n">hosts</span>
<span class="c1">############################################################</span>
<span class="p">[</span><span class="n">ndeployslaves</span><span class="p">]</span>  <span class="c1"># section containing all your slaves</span>
<span class="n">slave1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span> <span class="n">ansible_port</span><span class="o">=</span><span class="mi">22</span> <span class="n">server_id</span><span class="o">=</span><span class="mi">2</span> <span class="n">webserver</span><span class="o">=</span><span class="n">nginx</span>
<span class="c1"># ansible_port is ssh port</span>
<span class="c1"># server_id must be unique for each server</span>
<span class="c1"># webserver can be nginx or openresty</span>

<span class="p">[</span><span class="n">ndeploymaster</span><span class="p">]</span>  <span class="c1"># section containing masters FQDN .Only one entry should be there</span>
<span class="n">master</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span> <span class="n">ansible_port</span><span class="o">=</span><span class="mi">22</span> <span class="n">ansible_connection</span><span class="o">=</span><span class="n">local</span> <span class="n">server_id</span><span class="o">=</span><span class="mi">1</span> <span class="n">webserver</span><span class="o">=</span><span class="n">nginx</span>

<span class="p">[</span><span class="n">ndeploydbslave</span><span class="p">]</span> <span class="c1"># This section has the DB slave. Only one entry should be there</span>
<span class="n">slave1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span> <span class="n">ansible_port</span><span class="o">=</span><span class="mi">22</span> <span class="n">server_id</span><span class="o">=</span><span class="mi">2</span> <span class="n">webserver</span><span class="o">=</span><span class="n">nginx</span>
<span class="c1"># A slave can act as the DB slave too</span>
<span class="c1"># In a 2 server setup use the same entry here as in [ndeployslaves]</span>
<span class="c1"># In multi-slave setups, use any one of the slaves as DB slave.</span>
<span class="c1">#############################################################</span>

<span class="c1"># It is recommended that you run the command below in screen as it may take time to complete</span>
<span class="n">ansible</span><span class="o">-</span><span class="n">playbook</span> <span class="o">-</span><span class="n">i</span> <span class="o">./</span><span class="n">hosts</span> <span class="n">cluster</span><span class="o">.</span><span class="n">yml</span>

<span class="c1"># Once the Ansible play completes.The cluster is fully setup</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you see &#8220;ERROR! Unexpected Exception: &#8216;module&#8217; object has no attribute &#8216;HAVE_DECL_MPZ_POWM_SEC&#8217;&#8221; on centos6 do
yum remove python-crypto &amp;&amp; pip install ansible ( Ref: <a class="reference external" href="https://github.com/ansible/ansible/issues/276">https://github.com/ansible/ansible/issues/276</a> )</p>
</div>
<p>(optional) Add Additonal IP mapping if required</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Cluster setup automatically maps servers main IP&#39;s</span>
<span class="c1"># If you are using cloud by DigitalOcean ,Linode etc the automatic mapping is enough</span>
<span class="c1"># If you have multiple IP on master and slave, map additional IP&#39;s using command below</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">nDeploy</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">update_cluster_ipmap</span><span class="o">.</span><span class="n">py</span>
<span class="n">usage</span><span class="p">:</span> <span class="n">update_cluster_ipmap</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="n">slave_hostname</span> <span class="n">ip_here</span> <span class="n">remote_ip</span>
</pre></div>
</div>
<p>Quirks for which we need a human intervention sometimes!</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># The machine sometimes acts weird.</span>
<span class="c1"># Here are some weird behavior we notice that need manual intervention Just once after cluster setup</span>
<span class="c1"># We are still investigating reason for these and hopefully it will be fixed soon</span>

<span class="c1"># Unison doesn&#39;t start automatically on master after cluster setup</span>
<span class="n">systemctl</span> <span class="n">stop</span> <span class="n">ndeploy_unison</span>
<span class="n">systemctl</span> <span class="n">start</span> <span class="n">ndeploy_unison</span>

<span class="c1">#PostFix is not running on slave</span>
<span class="n">systemctl</span> <span class="n">restart</span> <span class="n">postfix</span>
</pre></div>
</div>
</div>
<div class="section" id="cpanel-horizontal-scaling-adding-more-web-servers">
<h2>cPanel Horizontal scaling . Adding more web servers<a class="headerlink" href="#cpanel-horizontal-scaling-adding-more-web-servers" title="Permalink to this headline">¶</a></h2>
<p>XtendWeb cluster&#8217;s important feature is horizontal scalability. Horizontal scalability helps a web application to scale up and down horizontally .</p>
<p>This is useful when a website has a termendous amount of traffic that one web server cannot handle. With Xtendweb all you need to add a new full processing</p>
<p>capable webserver is as below</p>
<p>The new Slave</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Prepare a fresh server and install cPanel DNS only on it</span>
<span class="n">cd</span> <span class="o">/</span><span class="n">home</span> <span class="o">&amp;&amp;</span> <span class="n">curl</span> <span class="o">-</span><span class="n">o</span> <span class="n">latest</span><span class="o">-</span><span class="n">dnsonly</span> <span class="o">-</span><span class="n">L</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">securedownloads</span><span class="o">.</span><span class="n">cpanel</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="n">latest</span><span class="o">-</span><span class="n">dnsonly</span> <span class="o">&amp;&amp;</span> <span class="n">sh</span> <span class="n">latest</span><span class="o">-</span><span class="n">dnsonly</span>
<span class="n">ssh</span><span class="o">-</span><span class="n">keygen</span>
<span class="n">ssh</span><span class="o">-</span><span class="n">copy</span><span class="o">-</span><span class="nb">id</span> <span class="n">root</span><span class="nd">@masters</span><span class="o">-</span><span class="n">fqdn</span>
<span class="c1"># Login to WHM</span>
<span class="c1"># Home »Service Configuration »Service Manager</span>
<span class="c1"># Disable tailwatchd and all its drivers</span>

<span class="c1"># Home »Server Configuration »Update Preferences</span>
<span class="c1"># Set cPanel &amp; WHM Updates to Never Update</span>
</pre></div>
</div>
<p>The Master</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd /opt/nDeploy/conf/nDeploy-cluster
vim /opt/nDeploy/conf/nDeploy-cluster/hosts

# Ensure the new servers hostname is added under [ndeployslaves]

ssh-copy-id root@new-slaves-fqdn

cd /opt/nDeploy/conf/nDeploy-cluster
ansible-playbook -i ./hosts cluster.yml


On master server login to WHM
Home »SQL Services »Additional MySQL Access Hosts

# Click on the &quot;click here&quot; link towards the end of the below message
Important: Users must log into cPanel and use the Remote MySQL feature to set up access from these hosts. After you have done this, if you would like to configure access from all users’ accounts click here.
</pre></div>
</div>
<p>Thats it. Your new host will start serving the website once the /home data is replicated.You can shutdown nginx on this host until data is replicated</p>
<p>Adding more webservers to horizontally scale a webapp will roughly take 10 minutes ( assuming a server with cPanel DNS only installed is used)</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="mod_remoteip.html" class="btn btn-neutral float-right" title="mod_remoteip" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="installation_standalone.html" class="btn btn-neutral" title="XtendWeb standalone installation" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, A U T O M 8 N.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'4.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-101881908-1', 'auto');
  ga('send', 'pageview');

</script>
<script type="text/javascript">
var LHCChatOptions = {};
LHCChatOptions.opt = {widget_height:340,widget_width:300,popup_height:520,popup_width:500};
(function() {
var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
var referrer = (document.referrer) ? encodeURIComponent(document.referrer.substr(document.referrer.indexOf('://')+1)) : '';
var location  = (document.location) ? encodeURIComponent(window.location.href.substring(window.location.protocol.length)) : '';
po.src = '//chat.gnusys.net/index.php/chat/getstatus/(click)/internal/(position)/bottom_right/(ma)/br/(top)/350/(units)/pixels/(leaveamessage)/true/(department)/1?r='+referrer+'&l='+location;
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
})();
</script>


</body>
</html>