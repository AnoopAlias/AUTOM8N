

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>XtendWeb Cluster Installation &mdash; Documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Documentation" href="index.html"/>
        <link rel="next" title="mod_remoteip" href="mod_remoteip.html"/>
        <link rel="prev" title="XtendWeb standalone installation" href="installation_standalone.html"/>
    <link href="_static/style.css" rel="stylesheet" type="text/css">


  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> A U T O M 8 N
          

          
            
            <img src="_static/XtendWeb.png" class="logo" />
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">XtendWeb setup</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation_standalone.html">XtendWeb standalone installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation_standalone.html#application-servers">Application servers</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">XtendWeb Cluster Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#xtendweb-cluster-introduction">XtendWeb Cluster Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#xtendweb-cluster-requirements">XtendWeb Cluster Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#xtendweb-cluster-setup">XtendWeb cluster setup</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mod_remoteip.html">mod_remoteip</a></li>
<li class="toctree-l1"><a class="reference internal" href="brotli_compression.html">brotli_compression</a></li>
<li class="toctree-l1"><a class="reference internal" href="http2.html">http2</a></li>
<li class="toctree-l1"><a class="reference internal" href="ModSecurity.html">ModSecurity</a></li>
<li class="toctree-l1"><a class="reference internal" href="Naxsi.html">Naxsi</a></li>
</ul>
<p class="caption"><span class="caption-text">User Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="UserDocs.html">XtendWeb User docs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="UserDocs.html#setup-url-redirects">Setup URL Redirects</a></li>
<li class="toctree-l2"><a class="reference internal" href="UserDocs.html#enable-directory-listing">Enable Directory listing</a></li>
<li class="toctree-l2"><a class="reference internal" href="UserDocs.html#content-optimization">Content Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="UserDocs.html#security-headers">Security Headers</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">SimpleR setup</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="simpler_resource_control.html">Simple Resource controller</a><ul>
<li class="toctree-l2"><a class="reference internal" href="simpler_resource_control.html#how-does-simpler-work">How does simpleR work</a></li>
<li class="toctree-l2"><a class="reference internal" href="simpler_resource_control.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="simpler_resource_control.html#default-resource-for-user">Default resource for user</a></li>
<li class="toctree-l2"><a class="reference internal" href="simpler_resource_control.html#tools-to-view-resource-usage">Tools to view resource usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="simpler_resource_control.html#to-view-systemd-config-loaded">To view systemd config loaded</a></li>
<li class="toctree-l2"><a class="reference internal" href="simpler_resource_control.html#to-view-the-cgroup-tree">To view the cgroup tree</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Support and Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Support.html">Support</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Support.html#if-you-have-already-purchased-a-support-plan">If you have already purchased a support plan</a></li>
<li class="toctree-l2"><a class="reference internal" href="Support.html#bug-report">Bug Report</a></li>
<li class="toctree-l2"><a class="reference internal" href="Support.html#announcements">Announcements</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Project_sponsors.html">Project Sponsors</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Project_sponsors.html#credits">CREDITS</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Partner_webhosts.html">Partner Webhosts</a></li>
</ul>
<p class="caption"><span class="caption-text">Application servers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="HHVM.html">Setting up HHVM</a><ul>
<li class="toctree-l2"><a class="reference internal" href="HHVM.html#on-centos7-cloudlinux7">On CentOS7 / CloudLinux7</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="PHP.html">Setting up PHP</a><ul>
<li class="toctree-l2"><a class="reference internal" href="PHP.html#on-centos6-centos7">On CentOS6/CentOS7</a></li>
<li class="toctree-l2"><a class="reference internal" href="PHP.html#on-cloudlinux6-cloudlinux7">On CloudLinux6/CloudLinux7</a></li>
<li class="toctree-l2"><a class="reference internal" href="PHP.html#php-fpm-user-level-master">PHP-FPM user level master</a></li>
<li class="toctree-l2"><a class="reference internal" href="PHP.html#where-are-my-php-logs">Where are my php logs?</a></li>
<li class="toctree-l2"><a class="reference internal" href="PHP.html#zendopcache-and-security-considerations-on-php-fpm-single-master-setup">ZendOpcache and security considerations on php-fpm single master setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="PHP.html#per-user-php-ini-custom-settings">Per user php.ini custom settings</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="PYTHON_WSGI.html">Setting up Python (WSGI app)</a></li>
<li class="toctree-l1"><a class="reference internal" href="RUBY_RACK.html">Setting up Ruby(Rack app)</a></li>
<li class="toctree-l1"><a class="reference internal" href="NodeJS.html">Setting up NodeJS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Meteor.html">Setting up Meteor</a></li>
<li class="toctree-l1"><a class="reference internal" href="ColdFusion_Java.html">Setting up ColdFusion or Java</a></li>
</ul>
<p class="caption"><span class="caption-text">Administration &amp; Monitoring</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="XtendWeb_Administration.html">Administration of XtendWeb plugin</a><ul>
<li class="toctree-l2"><a class="reference internal" href="XtendWeb_Administration.html#layer7-application-layer-ddos-mitigation">Layer7(Application layer) DDOS mitigation</a></li>
<li class="toctree-l2"><a class="reference internal" href="XtendWeb_Administration.html#automatic-fixing-of-most-errors">Automatic fixing of most errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="XtendWeb_Administration.html#managing-default-server-settings">Managing default server settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="XtendWeb_Administration.html#automatic-selection-of-template-based-on-application">Automatic selection of template based on application</a></li>
<li class="toctree-l2"><a class="reference internal" href="XtendWeb_Administration.html#adding-application-templates">Adding application templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="XtendWeb_Administration.html#adding-application-servers-or-backends">Adding Application servers or backends</a></li>
<li class="toctree-l2"><a class="reference internal" href="XtendWeb_Administration.html#upgrading-xtendweb-and-nginx">Upgrading XtendWeb and nginx</a></li>
<li class="toctree-l2"><a class="reference internal" href="XtendWeb_Administration.html#xtendweb-cluster-upgrade">XtendWeb cluster upgrade</a></li>
<li class="toctree-l2"><a class="reference internal" href="XtendWeb_Administration.html#migrating-xtendweb-settings">Migrating Xtendweb settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="XtendWeb_Administration.html#temporarily-disable-the-plugin">Temporarily disable the plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="XtendWeb_Administration.html#uninstall-the-plugin">Uninstall the plugin</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Application_template.html">Application templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="Monitoring.html">Monitoring nginx and app servers</a></li>
<li class="toctree-l1"><a class="reference internal" href="Logs.html">Managing Logs</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">A U T O M 8 N</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>XtendWeb Cluster Installation</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="xtendweb-cluster-installation">
<h1>XtendWeb Cluster Installation<a class="headerlink" href="#xtendweb-cluster-installation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="xtendweb-cluster-introduction">
<h2>XtendWeb Cluster Introduction<a class="headerlink" href="#xtendweb-cluster-introduction" title="Permalink to this headline">¶</a></h2>
<p>XtendWeb cluster is the worlds easiest web application clustering solution featuring a fully automated deployment of a clustered DNS loadbalanced LAMP stack.
It is specifically designed for multi datacenter deployment and use encrypted communication between the server</p>
<p>XtendWeb cluster provide high availability , scalability and an inherent data backup (application files and database are replicated and normally reside on 2 servers at any time )
Coupled with the simplicity and intutiveness of cPanel control panel ,XtendWeb cluster is a must have for any modern enterprise web application deployment</p>
<p>Cluster Components:</p>
<ol class="arabic simple">
<li>cPanel DNS providing multiple A records for round robin DNS loadbalancing</li>
<li>Nginx servers running on all servers with server specific settings and serving files independandly</li>
<li>Application servers (php-fpm. Phusion passenger )running on all servers and serving app independandly</li>
<li>Csync2 - Syncing config across all servers</li>
<li>Unison - Syncing files across all servers</li>
<li>MaxScale router and mariaDB master-master replication - Database replication and query routing</li>
<li>Redis &amp; stunnel - Secure sharing of PHP session</li>
<li>XtendWeb - generating and Syncing configuration for all servers</li>
</ol>
</div>
<div class="section" id="xtendweb-cluster-requirements">
<h2>XtendWeb Cluster Requirements<a class="headerlink" href="#xtendweb-cluster-requirements" title="Permalink to this headline">¶</a></h2>
<p>It is recommended that you setup XtendWeb cluster on CentOS7 with latest cPanel (v64 as of writing this).</p>
<p>We do support CentOS6, but it is less tested and has some disadvantages like stunnel startup script is lacking in CentOS6 .</p>
<p>XtendWeb cluster needs atleast 2 servers. Only one of the server need a valid cPanel license</p>
<p>Cluster provide horizontal scalability for web applications using DNS loadbalancing .</p>
<p>It is highly recommended that the servers be on different geographic regions ( eg: master in US , slave in UK ) and use different providers.
The golden rule is - Dont keep all your eggs in the same basket.</p>
<p>All communication between master and slave is TLS encrypted and is therefore safe .
The master and slave just need to be able to connect via internet.</p>
<p>The recommended way to upgrade to XtendWeb cluster from cPanel is setting up the cluster and migrating the websites over rather than setting up cluster
on the existing server.</p>
<p>Master server - Centos7 ,MariaDB 10.1</p>
<p>Slave Server&#8217;s - Centos7 ( installed with cPanel DNS only which is licensed free ).Rest of the software is installed automatically at cluster setup.</p>
</div>
<div class="section" id="xtendweb-cluster-setup">
<h2>XtendWeb cluster setup<a class="headerlink" href="#xtendweb-cluster-setup" title="Permalink to this headline">¶</a></h2>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Install CSF firewall on both servers and whitelist each others IP for access</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">The servers hostname must be valid and should resolve correctly(atleast from inside the master and slaves).
It is recommended that they resolve correctly on the internet</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As of XtendWeb 4.3.20 you will need a license for all servers(master and slaves) on the cluster .Else Installation will fail
Please visit <a class="reference external" href="https://autom8n.com/plans.html#plans">https://autom8n.com/plans.html#plans</a> for more info</p>
</div>
<p>1. Install cPanel and cPanel DNS only on master and slaves respectively</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># On Master</span>
<span class="n">cd</span> <span class="o">/</span><span class="n">home</span> <span class="o">&amp;&amp;</span> <span class="n">curl</span> <span class="o">-</span><span class="n">o</span> <span class="n">latest</span> <span class="o">-</span><span class="n">L</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">securedownloads</span><span class="o">.</span><span class="n">cpanel</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="n">latest</span> <span class="o">&amp;&amp;</span> <span class="n">sh</span> <span class="n">latest</span>

<span class="c1">#On Slaves</span>
<span class="n">cd</span> <span class="o">/</span><span class="n">home</span> <span class="o">&amp;&amp;</span> <span class="n">curl</span> <span class="o">-</span><span class="n">o</span> <span class="n">latest</span><span class="o">-</span><span class="n">dnsonly</span> <span class="o">-</span><span class="n">L</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">securedownloads</span><span class="o">.</span><span class="n">cpanel</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="n">latest</span><span class="o">-</span><span class="n">dnsonly</span> <span class="o">&amp;&amp;</span> <span class="n">sh</span> <span class="n">latest</span><span class="o">-</span><span class="n">dnsonly</span>
</pre></div>
</div>
<p>2. Install XtendWeb on master only</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># On Master only</span>
<span class="n">yum</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">epel</span><span class="o">-</span><span class="n">release</span>
<span class="n">yum</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">AnoopAlias</span><span class="o">/</span><span class="n">XtendWeb</span><span class="o">/</span><span class="n">raw</span><span class="o">/</span><span class="n">ndeploy4</span><span class="o">/</span><span class="n">nDeploy</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">centos</span><span class="o">-</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">6.</span><span class="n">noarch</span><span class="o">.</span><span class="n">rpm</span>

<span class="c1"># Purchase a license so the server can access xtendweb yum repo</span>

<span class="n">yum</span> <span class="o">-</span><span class="n">y</span> <span class="o">--</span><span class="n">enablerepo</span><span class="o">=</span><span class="n">ndeploy</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">nginx</span><span class="o">-</span><span class="n">nDeploy</span> <span class="n">nDeploy</span> <span class="c1"># For nginx as webserver</span>
   <span class="n">OR</span>
<span class="n">yum</span> <span class="o">-</span><span class="n">y</span> <span class="o">--</span><span class="n">enablerepo</span><span class="o">=</span><span class="n">ndeploy</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">openresty</span><span class="o">-</span><span class="n">nDeploy</span> <span class="n">nDeploy</span> <span class="c1"># For openresty as webserver</span>

<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">nDeploy</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">cpanel</span><span class="o">-</span><span class="n">nDeploy</span><span class="o">-</span><span class="n">setup</span><span class="o">.</span><span class="n">sh</span> <span class="n">enable</span>

<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">nDeploy</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">setup_additional_templates</span><span class="o">.</span><span class="n">sh</span>  <span class="c1"># For installing Wordpress and Drupal full page cache template</span>
</pre></div>
</div>
<p>3. On Master server Login to WHM and upgrade to MariaDB 10.1</p>
<div class="highlight-default"><div class="highlight"><pre><span></span># On Master only
Home »Software »MySQL/MariaDB Upgrade
Select MariaDB 10.1 (General availability)
and click &quot;Next&quot;
Ensure Upgrade completes successfully

Ensure password in /root/.my.cnf is enclosed in single quotes (eg password=&#39;mysecurepass&#39;)
Unquoted and double-quoted password can sometimes cause issues
</pre></div>
</div>
<p>4. Setup password-less ssh login between master and slaves</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#On master</span>
<span class="n">ssh</span><span class="o">-</span><span class="n">keygen</span>
<span class="n">ssh</span><span class="o">-</span><span class="n">copy</span><span class="o">-</span><span class="nb">id</span> <span class="n">root</span><span class="nd">@slaves</span><span class="o">-</span><span class="n">fqdn</span>

<span class="c1">#On slaves</span>
<span class="n">ssh</span><span class="o">-</span><span class="n">keygen</span>
<span class="n">ssh</span><span class="o">-</span><span class="n">copy</span><span class="o">-</span><span class="nb">id</span> <span class="n">root</span><span class="nd">@masters</span><span class="o">-</span><span class="n">fqdn</span>

<span class="c1">#Ensure passwordless login works for root</span>
</pre></div>
</div>
<p>5. Install Ansible on master</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># On master only</span>
<span class="n">yum</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">python</span><span class="o">-</span><span class="n">pip</span> <span class="n">libffi</span><span class="o">-</span><span class="n">devel</span> <span class="n">python</span><span class="o">-</span><span class="n">paramiko</span> <span class="n">python</span><span class="o">-</span><span class="n">jinja2</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">ansible</span>
</pre></div>
</div>
<p>6. Setup the hosts file on master</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># On a 2 server setup with default ssh port you just need to replace master and slave FQDN&#39;s in the sample file</span>
<span class="n">cd</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">nDeploy</span><span class="o">/</span><span class="n">conf</span><span class="o">/</span><span class="n">nDeploy</span><span class="o">-</span><span class="n">cluster</span>
<span class="n">cp</span> <span class="o">-</span><span class="n">p</span> <span class="n">hosts</span><span class="o">.</span><span class="n">sample</span> <span class="n">hosts</span>

<span class="c1"># Edit the hosts file</span>

<span class="n">cat</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">nDeploy</span><span class="o">/</span><span class="n">conf</span><span class="o">/</span><span class="n">nDeploy</span><span class="o">-</span><span class="n">cluster</span><span class="o">/</span><span class="n">hosts</span>

<span class="p">[</span><span class="n">ndeployslaves</span><span class="p">]</span>  <span class="c1"># section containing all your slaves</span>
<span class="n">slave1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span> <span class="n">ansible_port</span><span class="o">=</span><span class="mi">22</span> <span class="n">server_id</span><span class="o">=</span><span class="mi">2</span> <span class="n">webserver</span><span class="o">=</span><span class="n">nginx</span>
<span class="c1"># ansible_port is ssh port</span>
<span class="c1"># server_id must be unique for each server</span>
<span class="c1"># webserver can be nginx or openresty</span>

<span class="p">[</span><span class="n">ndeploymaster</span><span class="p">]</span>  <span class="c1"># section containing masters FQDN .Only one entry should be there</span>
<span class="n">master</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span> <span class="n">ansible_port</span><span class="o">=</span><span class="mi">22</span> <span class="n">ansible_connection</span><span class="o">=</span><span class="n">local</span> <span class="n">server_id</span><span class="o">=</span><span class="mi">1</span> <span class="n">webserver</span><span class="o">=</span><span class="n">nginx</span>

<span class="p">[</span><span class="n">ndeploydbslave</span><span class="p">]</span> <span class="c1"># This section has the DB slave .Only one entry should be there</span>
<span class="n">slave1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span> <span class="n">ansible_port</span><span class="o">=</span><span class="mi">22</span> <span class="n">server_id</span><span class="o">=</span><span class="mi">2</span> <span class="n">webserver</span><span class="o">=</span><span class="n">nginx</span>
<span class="c1"># A slave can act as the DB slave too</span>
<span class="c1"># In a 2 server setup use the same entry here as in [ndeployslaves]</span>
<span class="c1"># In multi slave setups, use one of the slaves as DB slave.</span>
</pre></div>
</div>
<p>7. Setup Cluster on master</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># It is recommended that you run the command below in screen as it may take time to complete</span>
<span class="n">ansible</span><span class="o">-</span><span class="n">playbook</span> <span class="o">-</span><span class="n">i</span> <span class="o">./</span><span class="n">hosts</span> <span class="n">cluster</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">If you see &#8220;ERROR! Unexpected Exception: &#8216;module&#8217; object has no attribute &#8216;HAVE_DECL_MPZ_POWM_SEC&#8217;&#8221; on centos6 do
yum remove python-crypto &amp;&amp; pip install ansible ( Ref: <a class="reference external" href="https://github.com/ansible/ansible/issues/276">https://github.com/ansible/ansible/issues/276</a> )</p>
</div>
<p>8. (optional) Add Additonal IP mapping if required</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Cluster setup automatically maps servers main IP&#39;s</span>
<span class="c1"># If you are using cloud by DigitalOcean ,Linode etc the automatic mapping is enough</span>
<span class="c1"># If you have multiple IP on master and slave, map additional IP&#39;s using command below</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">nDeploy</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">update_cluster_ipmap</span><span class="o">.</span><span class="n">py</span>
<span class="n">usage</span><span class="p">:</span> <span class="n">update_cluster_ipmap</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="n">slave_hostname</span> <span class="n">ip_here</span> <span class="n">remote_ip</span>
</pre></div>
</div>
<p>9. Quirks for which we need a human intervention sometimes!</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># The machine sometimes act weired .</span>
<span class="c1"># Here are some weired behaviour we notice that need manual intervention</span>
<span class="c1"># We are still investigating reason for these and hopefully it will be fixed soon</span>

<span class="c1"># Unison doesnt start automatically on master after cluster setup</span>
<span class="n">systemctl</span> <span class="n">stop</span> <span class="n">ndeploy_unison</span>
<span class="n">systemctl</span> <span class="n">start</span> <span class="n">ndeploy_unison</span>

<span class="c1">#PostFix is not running on slave( see tip below and disable checksrvd and upcp cron)</span>
<span class="n">systemctl</span> <span class="n">restart</span> <span class="n">postfix</span>
</pre></div>
</div>
<p>The cluster including PHP app server is fully setup now  and you can start adding accounts .Cluster automatically setus up DNS clustering
and you should use master and slaves as the nameservers for the domain to ensure DNS LoadBalancing.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>Disable chkservd and all its drivers on slave dns only servers as chkservd can cause troubles in cluster operation.</p>
<p class="last">Disable all cronjobs including upcp cron in slaves crontab ( upcp sometimes removes non-cpanel componets setup by the cluster )</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="mod_remoteip.html" class="btn btn-neutral float-right" title="mod_remoteip" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="installation_standalone.html" class="btn btn-neutral" title="XtendWeb standalone installation" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Anoop P Alias.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'4.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>