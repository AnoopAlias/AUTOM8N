touch /opt/nDeploy/conf/backends.yaml
/opt/nDeploy/scripts/update_backend.py add PROXY httpd 0
/opt/nDeploy/scripts/update_backend.py del PROXY redirect 0
/opt/nDeploy/scripts/update_backend.py del PROXY apache 9999
/opt/nDeploy/scripts/update_backend.py del PROXY apache_SSL 4430
touch /opt/nDeploy/conf/profiles.yaml
/opt/nDeploy/scripts/update_profiles.py add root PROXY 1000 "Proxy to httpd"
#/opt/nDeploy/scripts/update_profiles.py add root PROXY 1001 "A ColdFusion App"
/opt/nDeploy/scripts/update_profiles.py add root PROXY 1005 "Proxy to httpd(cached)"
/opt/nDeploy/scripts/update_profiles.py add root RUBY 2001 "Ruby on Rails(Rack) App"
/opt/nDeploy/scripts/update_profiles.py add root PYTHON 3001 "Python(WSGI) App"
/opt/nDeploy/scripts/update_profiles.py add root NODEJS 4001 "A NodeJS application"
/opt/nDeploy/scripts/update_profiles.py add root NODEJS 4002 "Ghost Blog"
/opt/nDeploy/scripts/update_profiles.py add root PHP 5001 "Wordpress"
/opt/nDeploy/scripts/update_profiles.py add root PHP 5002 "Joomla"
/opt/nDeploy/scripts/update_profiles.py add root PHP 5003 "Magento"
/opt/nDeploy/scripts/update_profiles.py add root PHP 5012 "X-Cart"
/opt/nDeploy/scripts/update_profiles.py add root PHP 5013 "SilverStripe"
/opt/nDeploy/scripts/update_profiles.py add root PHP 5014 "CMS Made Simple"
/opt/nDeploy/scripts/update_profiles.py add root PHP 5015 "Codeignitor"
/opt/nDeploy/scripts/update_profiles.py add root PHP 5016 "Drupal7 or higher"
/opt/nDeploy/scripts/update_profiles.py add root PHP 5017 "Drupal6 or lower"
/opt/nDeploy/scripts/update_profiles.py add root PHP 5018 "Prestashop"
/opt/nDeploy/scripts/update_profiles.py add root PHP 5019 "Moodle"
/opt/nDeploy/scripts/update_profiles.py add root PHP 5020 "OwnCloud"
/opt/nDeploy/scripts/update_profiles.py add root PHP 5021 "WHMCS"
/opt/nDeploy/scripts/update_profiles.py add root PHP 5022 "Laravel"
/opt/nDeploy/scripts/update_profiles.py add root PHP 5023 "Snipe-IT"
/opt/nDeploy/scripts/update_profiles.py add root HHVM_NOBODY 5001 "Wordpress"
/opt/nDeploy/scripts/update_profiles.py add root HHVM_NOBODY 5002 "Joomla"
/opt/nDeploy/scripts/update_profiles.py add root HHVM_NOBODY 5003 "Magento"
/opt/nDeploy/scripts/update_profiles.py add root HHVM_NOBODY 5012 "X-Cart"
/opt/nDeploy/scripts/update_profiles.py add root HHVM_NOBODY 5013 "SilverStripe"
/opt/nDeploy/scripts/update_profiles.py add root HHVM_NOBODY 5014 "CMS Made Simple"
/opt/nDeploy/scripts/update_profiles.py add root HHVM_NOBODY 5015 "Codeignitor"
/opt/nDeploy/scripts/update_profiles.py add root HHVM_NOBODY 5016 "Drupal7 or higher"
/opt/nDeploy/scripts/update_profiles.py add root HHVM_NOBODY 5017 "Drupal6 or lower"
/opt/nDeploy/scripts/update_profiles.py add root HHVM_NOBODY 5018 "Prestashop"
/opt/nDeploy/scripts/update_profiles.py add root HHVM_NOBODY 5019 "Moodle"
/opt/nDeploy/scripts/update_profiles.py add root HHVM_NOBODY 5020 "OwnCloud"
/opt/nDeploy/scripts/update_profiles.py add root HHVM_NOBODY 5021 "WHMCS"
/opt/nDeploy/scripts/update_profiles.py add root HHVM_NOBODY 5022 "Laravel"
/opt/nDeploy/scripts/update_profiles.py add root HHVM_NOBODY 5023 "Snipe-IT"

echo -e '\e[93m Adding cpanel hooks \e[0m'

/usr/local/cpanel/bin/manage_hooks delete script /opt/nDeploy/scripts/cpanel_functions_hook_post.py --category Cpanel --event Api2::SubDomain::addsubdomain --stage post --manual --exectype script --escalateprivs
/usr/local/cpanel/bin/manage_hooks delete script /opt/nDeploy/scripts/cpanel_functions_hook_post.py --category Cpanel --event Api2::SubDomain::changedocroot --stage post --manual --exectype script --escalateprivs
/usr/local/cpanel/bin/manage_hooks delete script /opt/nDeploy/scripts/cpanel_functions_hook_post.py --category Cpanel --event Api2::SubDomain::delsubdomain --stage post --manual --exectype script --escalateprivs
/usr/local/cpanel/bin/manage_hooks delete script /opt/nDeploy/scripts/cpanel_functions_hook_post.py --category Cpanel --event Api2::AddonDomain::addaddondomain --stage post --manual --exectype script --escalateprivs
/usr/local/cpanel/bin/manage_hooks delete script /opt/nDeploy/scripts/cpanel_functions_hook_post.py --category Cpanel --event Api2::AddonDomain::deladdondomain --stage post --manual --exectype script --escalateprivs
/usr/local/cpanel/bin/manage_hooks delete script /opt/nDeploy/scripts/cpanel_functions_hook_post.py --category Cpanel --event Api1::Park::park --stage post --manual --exectype script --escalateprivs
/usr/local/cpanel/bin/manage_hooks delete script /opt/nDeploy/scripts/cpanel_functions_hook_post.py --category Cpanel --event Api1::Park::unpark --stage post --manual --exectype script --escalateprivs
/usr/local/cpanel/bin/manage_hooks delete script /opt/nDeploy/scripts/cpanel_functions_hook_post.py --category Cpanel --event UAPI::SSL::delete_ssl --stage post --manual --exectype script --escalateprivs
/usr/local/cpanel/bin/manage_hooks delete script /opt/nDeploy/scripts/cpanel_functions_hook_post.py --category Cpanel --event UAPI::SSL::install_ssl --stage post --manual --exectype script --escalateprivs
/usr/local/cpanel/bin/manage_hooks delete script /opt/nDeploy/scripts/reload_nginx.sh --category Stats --event RunAll --stage post --manual
/usr/local/cpanel/bin/manage_hooks delete script /opt/nDeploy/scripts/runuserstats_hook_post.py --category Stats --event RunUser --stage post --manual
/usr/local/cpanel/bin/manage_hooks delete script /opt/nDeploy/scripts/reload_watcher.sh --category System --event upcp --stage post --manual
/usr/local/cpanel/bin/manage_hooks delete script /opt/nDeploy/scripts/accountmodify_hook_pre.py --category Whostmgr --event Accounts::Modify --stage pre --manual
/usr/local/cpanel/bin/manage_hooks delete script /opt/nDeploy/scripts/accountmodify_hook_post.py --category Whostmgr --event Accounts::Modify --stage post --manual
/usr/local/cpanel/bin/manage_hooks delete script /opt/nDeploy/scripts/accountremove_hook_pre.py --category Whostmgr --event Accounts::Remove --stage pre --manual
/usr/local/cpanel/bin/manage_hooks delete script /opt/nDeploy/scripts/accountremove_hook_post.py --category Whostmgr --event Accounts::Remove --stage post --manual
/usr/local/cpanel/bin/manage_hooks delete script /opt/nDeploy/scripts/accountcreate_hook_post.py --category Whostmgr --event Accounts::Create --stage post --manual
/usr/local/cpanel/bin/manage_hooks delete script /opt/nDeploy/scripts/cpanel_functions_hook_post.py --category Whostmgr --event Accounts::suspendacct --stage post --manual
/usr/local/cpanel/bin/manage_hooks delete script /opt/nDeploy/scripts/cpanel_functions_hook_post.py --category Whostmgr --event Accounts::unsuspendacct --stage post --manual
/usr/local/cpanel/bin/manage_hooks delete script /opt/nDeploy/scripts/cpanel_functions_hook_post.py --category Whostmgr --event Accounts::SiteIP::set --stage post --manual

/usr/local/cpanel/bin/manage_hooks add script /opt/nDeploy/scripts/cpanel_functions_hook_post.py --category Cpanel --event Api2::SubDomain::addsubdomain --stage post --manual --exectype script --escalateprivs
/usr/local/cpanel/bin/manage_hooks add script /opt/nDeploy/scripts/cpanel_functions_hook_post.py --category Cpanel --event Api2::SubDomain::changedocroot --stage post --manual --exectype script --escalateprivs
/usr/local/cpanel/bin/manage_hooks add script /opt/nDeploy/scripts/cpanel_functions_hook_post.py --category Cpanel --event Api2::SubDomain::delsubdomain --stage post --manual --exectype script --escalateprivs
/usr/local/cpanel/bin/manage_hooks add script /opt/nDeploy/scripts/cpanel_functions_hook_post.py --category Cpanel --event Api2::AddonDomain::addaddondomain --stage post --manual --exectype script --escalateprivs
/usr/local/cpanel/bin/manage_hooks add script /opt/nDeploy/scripts/cpanel_functions_hook_post.py --category Cpanel --event Api2::AddonDomain::deladdondomain --stage post --manual --exectype script --escalateprivs
/usr/local/cpanel/bin/manage_hooks add script /opt/nDeploy/scripts/cpanel_functions_hook_post.py --category Cpanel --event Api1::Park::park --stage post --manual --exectype script --escalateprivs
/usr/local/cpanel/bin/manage_hooks add script /opt/nDeploy/scripts/cpanel_functions_hook_post.py --category Cpanel --event Api1::Park::unpark --stage post --manual --exectype script --escalateprivs
/usr/local/cpanel/bin/manage_hooks add script /opt/nDeploy/scripts/cpanel_functions_hook_post.py --category Cpanel --event UAPI::SSL::delete_ssl --stage post --manual --exectype script --escalateprivs
/usr/local/cpanel/bin/manage_hooks add script /opt/nDeploy/scripts/cpanel_functions_hook_post.py --category Cpanel --event UAPI::SSL::install_ssl --stage post --manual --exectype script --escalateprivs
/usr/local/cpanel/bin/manage_hooks add script /opt/nDeploy/scripts/accountcreate_hook_post.py --category Whostmgr --event Accounts::Create --stage post --manual
/usr/local/cpanel/bin/manage_hooks add script /opt/nDeploy/scripts/accountremove_hook_post.py --category Whostmgr --event Accounts::Remove --stage post --manual
/usr/local/cpanel/bin/manage_hooks add script /opt/nDeploy/scripts/cpanel_functions_hook_post.py --category Whostmgr --event Accounts::suspendacct --stage post --manual
/usr/local/cpanel/bin/manage_hooks add script /opt/nDeploy/scripts/cpanel_functions_hook_post.py --category Whostmgr --event Accounts::unsuspendacct --stage post --manual
/usr/local/cpanel/bin/manage_hooks add script /opt/nDeploy/scripts/cpanel_functions_hook_post.py --category Whostmgr --event Accounts::SiteIP::set --stage post --manual
/usr/local/cpanel/bin/manage_hooks add script /opt/nDeploy/scripts/reload_watcher.sh --category System --event upcp --stage post --manual
/usr/local/cpanel/bin/manage_hooks add script /opt/nDeploy/scripts/reload_nginx.sh --category Stats --event RunAll --stage post --manual
/usr/local/cpanel/bin/manage_hooks add script /opt/nDeploy/scripts/runuserstats_hook_post.py --category Stats --event RunUser --stage post --manual
/usr/local/cpanel/bin/manage_hooks add script /opt/nDeploy/scripts/accountmodify_hook_pre.py --category Whostmgr --event Accounts::Modify --stage pre --manual
/usr/local/cpanel/bin/manage_hooks add script /opt/nDeploy/scripts/accountmodify_hook_post.py --category Whostmgr --event Accounts::Modify --stage post --manual
/usr/local/cpanel/bin/manage_hooks add script /opt/nDeploy/scripts/accountremove_hook_pre.py --category Whostmgr --event Accounts::Remove --stage pre --manual


if [ -z "$PHPBREW_ROOT" ] ; then
	export PHPBREW_ROOT=/usr/local/phpbrew
	echo "export PHPBREW_ROOT=/usr/local/phpbrew" >> /root/.bashrc
fi
if [ -z "$NVM_DIR" ] ; then
	export NVM_DIR="/usr/local/nvm"
	echo "export NVM_DIR=/usr/local/nvm" >> /root/.bashrc
fi
if [ ! -d /opt/nDeploy/domain-data ] ; then
	mkdir /opt/nDeploy/domain-data
fi
if [ ! -d /opt/nDeploy/php-fpm.d ] ; then
	mkdir /opt/nDeploy/php-fpm.d
	cat /opt/nDeploy/conf/php-fpm_default.pool > /opt/nDeploy/php-fpm.d/nobody.conf
fi
if [ ! -L /usr/local/cpanel/base/frontend/x3/nDeploy_cp  ];then
	ln -s /opt/nDeploy/nDeploy_cp /usr/local/cpanel/base/frontend/x3/
fi
if [ ! -L /usr/local/cpanel/base/frontend/paper_lantern/nDeploy_cp  ];then
	ln -s /opt/nDeploy/nDeploy_cp /usr/local/cpanel/base/frontend/paper_lantern/
fi
if [ ! -L /opt/nDeploy/scripts/easy_passenger_setup.sh ];then
  ln -s /usr/nginx/scripts/nginx-passenger-setup.sh /opt/nDeploy/scripts/easy_passenger_setup.sh
fi

echo -e '\e[93m Installing nDeploy plugin in cPanel \e[0m'
/usr/local/cpanel/scripts/install_plugin /opt/nDeploy/nDeploy_cp
/usr/local/cpanel/scripts/install_plugin /opt/nDeploy/nDeploy_cp --theme x3
