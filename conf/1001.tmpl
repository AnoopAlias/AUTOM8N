#PAGESPEED_NOT_ENABLED;
index  index.cfm index.html index.htm;

#Proxy Pass to a railo appServer listening on port 8888
location / {
        # Rewrite rules and other criterias can go here
        # Remember to avoid using if() where possible (http://wiki.nginx.org/IfIsEvil)
        try_files $uri $uri/ @rewrites;
}
 
location @rewrites {
        # Can put some of your own rewrite rules in here
        # for example rewrite ^/~(.*)/(.*)/? /users/$1/$2 last;
        rewrite ^/(.*)? /index.cfm/$1 last;
        rewrite ^ /index.cfm last;
}

location ~* /railo-context/admin/ {
	proxy_send_timeout   90;
        proxy_read_timeout   90;

        proxy_buffer_size    4k;
        proxy_buffers     16 32k;
        proxy_busy_buffers_size 64k;
        proxy_temp_file_write_size 64k;

        proxy_connect_timeout 30s;
        proxy_pass      http://PROXYLOCATION;
        proxy_redirect off;
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-Host $host;
        proxy_set_header X-Forwarded-Server $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Real-IP $remote_addr;
}
 
# Main Railo proxy handler
location ~ \.(cfm|cfml|cfc|jsp|cfr)(.*)$ {
	proxy_send_timeout   90;
        proxy_read_timeout   90;

        proxy_buffer_size    4k;
        proxy_buffers     16 32k;
        proxy_busy_buffers_size 64k;
        proxy_temp_file_write_size 64k;

        proxy_connect_timeout 30s;

  	proxy_pass http://PROXYLOCATION;
 	proxy_redirect off;
 	proxy_set_header Host $host;
 	proxy_set_header X-Forwarded-Host $host;
 	proxy_set_header X-Forwarded-Server $host;
 	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
 	proxy_set_header X-Real-IP $remote_addr;
}


include /etc/nginx/conf.d/cpanel_services.conf;
